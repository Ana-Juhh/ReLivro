<!doctype html>
<html lang="pt-br">
<head>
    <!-- Definindo a codificação de caracteres para UTF-8 -->
    <meta charset="utf-8">
    <!-- Configurando a visualização para dispositivos móveis -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ReLivro</title>
    
    <!-- Link para o CSS do Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Link para CSS-->
    <!-- Barra de navegação -->
    <nav class="navbar navbar-expand-lg" style="background-color: #121212; color: white;">
        <div class="container-fluid">
            <!-- Logo da empresa -->
            <a class="navbar-brand" href="#">
                <img src="logorelivro.png" alt="Logo" width="80" height="80">
            </a>
            <!-- Botão para alternar a navegação em telas menores -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <!-- Itens de navegação -->
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    
            </div>
        </div>
    </nav>

    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">

    <style>
      .img-product {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 50%;
      }
    </style>
  </head>
  <body class="bg-light">

    <div class="container">
      <div class="py-5 text-center">
        <h2>Formulário de Pagamento</h2>


        <p class="lead">Preencha seus dados para finalizar sua compra.</p>
      </div>

      <div class="row">
        <!-- Endereço -->
        <div class="col-md-8 order-md-1">
          <h4 class="mb-3">Endereço de cobrança</h4>
          <form class="needs-validation" novalidate onsubmit="finalizarCompra(event)">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="firstName">Nome</label>
                <input type="text" class="form-control" id="firstName" required>
              </div>
              <div class="col-md-6 mb-3">
                <label for="lastName">Sobrenome</label>
                <input type="text" class="form-control" id="lastName" required>
              </div>
            </div>

            <div class="mb-3">
              <label for="email">Email <span class="text-muted">(Opcional)</span></label>
              <input type="email" class="form-control" id="email" placeholder="email@exemplo.com">
            </div>

            <div class="mb-3">
              <label for="address">Endereço</label>
              <input type="text" class="form-control" id="address" placeholder="Rua,avenida, nº 0" required>
            </div>

            <div class="mb-3">
              <label for="address2">Complemento <span class="text-muted">(Opcional)</span></label>
              <input type="text" class="form-control" id="address2" placeholder="Apartamento ou casa">
            </div>

            <div class="row">
              <div class="col-md-5 mb-3">
                <label for="country">País</label>
                <select class="custom-select d-block w-100" id="country" required>
                  <option value="">Escolha...</option>
                  <option>Brasil</option>
                </select>
              </div>
              <div class="col-md-4 mb-3">
                <label for="state">Estado</label>
                <select class="custom-select d-block w-100" id="state" required>
                  <option value="">Escolha...</option>
                  <option>São Paulo</option>
                  <option>Rio de Janeiro</option>
                  <option>Minas Gerais</option>
                  <option>Espirito Santo</option>
                  <option>Goiás</option>
                  <option>Mato Grosso</option>
                  <option>Mato Grosso do Sul</option>
                  <option>Santa Catarina</option>
                  <option>Rio Grande do Sul</option>
                  <option>Sergipe</option>
                  <option>Paraná</option>
                  <option>Ceará</option>
                  <option>Bahia</option>
                  <option>Pernambuco</option>
                  <option>Paraíba</option>
                  <option>Rio Grande do Norte</option>
                  <option>Amazonas</option>
                  <option>Pará</option>
                  <option>Maranhão</option>
                  <option>Amapá</option>
                  <option>Acre</option>
                  <option>Alagoas</option>
                  <option>Piauí</option>
                  <option>Tocantins</option>
                  <option>Roraima</option>
                  <option>Rondônia</option>
                  <option>Sergipe</option>
                </select>
              </div>
              <div class="col-md-3 mb-3">
                <label for="zip">CEP</label>
                <input type="text" class="form-control" id="zip" placeholder="" required>
              </div>
            </div>
            <div class="mb-3">
              <label for="shipping">Frete</label>
              <select class="custom-select d-block w-100" id="shipping" required onchange="atualizarTotalComFrete()">
                <option value="" disabled selected>Escolha o frete...</option>
                <option value="0">Retirada na loja (Grátis)</option>
                <option value="10">PAC - R$10,00</option>
                <option value="20">Sedex - R$20,00</option>
              </select>
            </div>
            <hr class="mb-4">

            <!-- Forma de pagamento -->
            <h4 class="mb-3">Pagamento</h4>

            <div class="d-block my-3">
              <div class="custom-control custom-radio">
                <input id="credit" name="paymentMethod" type="radio" class="custom-control-input" checked required>
                <label class="custom-control-label" for="credit">Cartão de crédito</label>
              </div>
              <div class="custom-control custom-radio">
                <input id="debit" name="paymentMethod" type="radio" class="custom-control-input" required>
                <label class="custom-control-label" for="debit">Cartão de débito</label>
              </div>
              <div class="custom-control custom-radio">
                <input id="pix" name="paymentMethod" type="radio" class="custom-control-input" required>
                <label class="custom-control-label" for="pix">Pix</label>
              </div>
              <div class="custom-control custom-radio">
                <input id="paypal" name="paymentMethod" type="radio" class="custom-control-input" required>
                <label class="custom-control-label" for="paypal">Paypal</label>
              </div>
            </div>

            <div id="card-details">
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="cc-name">Nome no cartão</label>
                  <input type="text" class="form-control" id="cc-name" required>
                  <small class="text-muted">Nome completo como mostrado no cartão</small>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="cc-number">Número do cartão</label>
                  <input type="text" class="form-control" id="cc-number" required>
                </div>
              </div>

              <div class="row">
                <div class="col-md-3 mb-3">
                  <label for="cc-expiration">Validade</label>
                  <input type="text" class="form-control" id="cc-expiration" placeholder="MM/AA" required>
                </div>
                <div class="col-md-3 mb-3">
                  <label for="cc-cvv">CVV</label>
                  <input type="text" class="form-control" id="cc-cvv" required>
                </div>
              </div>
            </div>
            <div id="pix-details" class="text-center my-5" style="display: none;">
              <h5>Pagamento via Pix</h5>
              <p>Escaneie o QR Code abaixo para confirmar seu pagamento:</p>
              <div class="d-flex justify-content-center">
                  <img src="IMG/qrcode_pagamento_concluido.png" alt="QR Code Pix que redireciona" width="200" height="200">
              </div>
              <p class="mt-3"><strong>Chave Pix:</strong> chavepix@seudominio.com.br</p>
              <button class="btn btn-secondary btn-sm" onclick="copiarChavePix()">Copiar chave</button>
          </div>
            <hr class="mb-4">
            <button class="btn btn-primary btn-lg btn-block" type="submit">
              Finalizar compra
            </button>
          </form>
        </div>

        <!-- Carrinho -->
        <div class="col-md-4 order-md-2 mb-4">
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-muted">Seu carrinho</span>
            <span class="badge badge-secondary badge-pill" id="cart-count">3</span>
          </h4>

          <ul class="list-group mb-3" id="cart-items">
            
          </ul>
        </div>
      </div>
    </div>
    
      

    <!-- Bootstrap + jQuery -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>

    <script>
      var quantities = {1: 1, 2: 1, 3: 1};
      var prices = {1: 12, 2: 8, 3: 5};

      function updateTotal() {
        let total = 0;
        for (let id in quantities) {
          total += quantities[id] * prices[id];
        }
        document.getElementById('total-price').innerText = total;
      }

      function addItem(id) {
        quantities[id]++;
        document.getElementById('qty' + id).innerText = quantities[id];
        updateTotal();
      }

      function removeItem(id) {
        if (quantities[id] > 0) {
          quantities[id]--;
          document.getElementById('qty' + id).innerText = quantities[id];
          updateTotal();
        }
      }

      // Esconde ou mostra campos de cartão
            $('input[name="paymentMethod"]').on('change', function () {
        if ($('#pix').is(':checked')) {
            $('#card-details').hide();
            $('#pix-details').show();
        } else {
            $('#card-details').show();
            $('#pix-details').hide();
        }
        });


      // Inicialmente mostrar
      $(document).ready(function () {
        $('#card-details').show();
        $('#pix-details').hide();
        });

        function copiarChavePix() {
          const chave = 'chavepix@seudominio.com.br';
          navigator.clipboard.writeText(chave).then(() => {
              alert('Chave Pix copiada para a área de transferência!');
              // Redireciona após o alerta
              window.location.href = 'pagamento-concluido.html'; // Substitua pelo caminho correto da sua página
          });
        }

        function finalizarCompra(event) {
  event.preventDefault();

  const form = event.target;

  // Verificação padrão do HTML5 com Bootstrap
  if (!form.checkValidity()) {
    form.classList.add('was-validated');
    return;
  }

  // Agora sim, tudo validado: mostra carregamento
  const loader = document.getElementById("pagamento-processando");
  loader.style.display = "flex";

  const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
  const frete = parseFloat(document.getElementById("shipping").value) || 0;
  const totalSemFrete = parseFloat(localStorage.getItem("valorTotalSemFrete")) || 0;
  const totalComFrete = totalSemFrete + frete;

  localStorage.setItem("frete", frete.toFixed(2));
  localStorage.setItem("totalPago", totalComFrete.toFixed(2));

  // Redireciona após 5 segundos
  setTimeout(() => {
    window.location.href = 'pagamento-concluido.html';
  }, 5000);
}

    </script>

<script src="livro.js"></script>

<script>
 document.addEventListener("DOMContentLoaded", () => {
    const carrinho = JSON.parse(localStorage.getItem("carrinho")) || [];
    const cartItemsContainer = document.getElementById("cart-items");
    const cartCount = document.getElementById("cart-count");

    let total = 0;

    if (carrinho.length === 0) {
      cartItemsContainer.innerHTML = `<li class="list-group-item">Seu carrinho está vazio.</li>`;
      cartCount.textContent = "0";
      return;
    }

    // Mostrar cada item
    carrinho.forEach((item) => {
      const preco = typeof item.preco === "string"
        ? parseFloat(item.preco.replace("R$", "").replace(",", "."))
        : item.preco;

      total += preco * item.quantidade;

      const li = document.createElement("li");
      li.className = "list-group-item d-flex justify-content-between lh-condensed";
      li.innerHTML = `
        <div class="d-flex align-items-center">
          <img src="${item.imagem}" alt="${item.nome}" class="img-product mr-2">
          <div>
            <h6 class="my-0">${item.nome}</h6>
            <small class="text-muted">Qtd: ${item.quantidade}</small>
          </div>
        </div>
        <span class="text-muted">R$ ${(preco * item.quantidade).toFixed(2).replace('.', ',')}</span>
      `;
      cartItemsContainer.appendChild(li);
    });

    // Mostrar total
    const totalElement = document.createElement("li");
    totalElement.className = "list-group-item d-flex justify-content-between";
    totalElement.innerHTML = `
      <span><strong>Total (BRL)</strong></span>
      <strong>R$ ${total.toFixed(2).replace('.', ',')}</strong>
    `;
    cartItemsContainer.appendChild(totalElement);

    // Atualiza contador do carrinho
    cartCount.textContent = carrinho.length;

    // Salva valor para uso no cálculo do frete
    localStorage.setItem("valorTotalSemFrete", total.toFixed(2));
  });
  </script>
  
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const dadosCompra = JSON.parse(localStorage.getItem("dadosCompra")) || { itens: [] };
      const carrinhoExtra = JSON.parse(localStorage.getItem("carrinho")) || [];
  
      // Unificar carrinhos
      const carrinhoUnificado = [
        ...dadosCompra.itens,
        ...carrinhoExtra.map(item => ({
          titulo: item.nome || item.titulo,
          preco: parseFloat(item.preco.replace("R$", "").replace(",", ".")),
          imagem: item.imagem
        }))
      ];
  
      const cartItemsContainer = document.getElementById("cart-items");
      const cartCount = document.getElementById("cart-count");
  
      let total = 0;
  
      if (carrinhoUnificado.length > 0) {
        cartCount.textContent = carrinhoUnificado.length;
  
        carrinhoUnificado.forEach(item => {
          const li = document.createElement("li");
          li.className = "list-group-item d-flex justify-content-between lh-condensed";
          li.innerHTML = `
            <div>
              <h6 class="my-0">${item.titulo}</h6>
            </div>
            <span class="text-muted">R$ ${item.preco.toFixed(2)}</span>
          `;
          cartItemsContainer.appendChild(li);
          total += item.preco;
        });
  
        const totalElement = document.createElement("li");
        totalElement.className = "list-group-item d-flex justify-content-between";
        totalElement.innerHTML = `
          <span><strong>Total (BRL)</strong></span>
          <strong>R$ ${total.toFixed(2)}</strong>
        `;
        cartItemsContainer.appendChild(totalElement);
  
        // Salvar no localStorage para uso posterior (frete e pagamento final)
        localStorage.setItem("valorTotalSemFrete", total.toFixed(2));
      } else {
        cartItemsContainer.innerHTML = `<li class="list-group-item">Seu carrinho está vazio.</li>`;
        cartCount.textContent = "0";
      }
    });


    
  </script>
  
  <div id="pagamento-processando" style="display: none; position: fixed; top: 0; left: 0; 
  width: 100%; height: 100%; background-color: rgba(255,255,255,0.9); 
  z-index: 9999; flex-direction: column; align-items: center; justify-content: center;">
  <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
    <span class="visually-hidden">Processando...</span>
  </div>
  <p class="mt-3 fs-5 text-dark">Processando pagamento...</p>
</div>

  </body>
</html>